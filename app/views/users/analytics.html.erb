<h1>Planet Flatiron Analytics</h1>

<h2>Total customer base: <%=@basic_users.count%></h2>
  <%@plans.each do |plan|%>
    <p>Ratio of customers who are enrolled in <%=plan.name%> plan: <%=((plan.users.count.to_f / @basic_users.count)*100).round(2)%>% (<%=plan.users.count%>/<%=@basic_users.count%>)</p>
  <%end%>

<h2>Total number of trainers: <%=Trainer.all.count%></h2>
<h3>Trainers sorted by revenue generation:</h3>

  <%Trainer.sorted_popularity.each do |t|%>
    <%=t[0].name%> teaches <%=t[1]%> customers and generates $<%=t[0].trainer_revenue%><br>
  <%end%>
  <br>Note that the above may not sum to the total gym revenue, as some users who are signed up for a plan, may not be enrolled in any lessons.

<h2>Total revenue: $<%=Plan.total_revenue%></h2>

  <%@plans.each do |plan|%>
    <p>Total revenue being generated by <%=plan.name%> plan: $<%=plan.plan_revenue%></p>
  <%end%>

<!--  -->
<h2>Revenue Forcasting</h2>
Revenue generated by increasing fees per plan
<h4>Forcasting revenue: $<%=Plan.total_revenue%></h4>

  <%@plans.each do |plan|%>
    <p> Revenue <%=plan.name%> plan: $<span id="forcastDisplay<%=plan.level%>"><%=plan.plan_revenue%></span>
        <input type="text" id="futureValue<%=plan.level%>" value="<%=plan.price%>">
        <!-- <input type="submit" id="futureValueSubmit<%=plan.level%>" value="See Forcast"> -->
        <!-- <button type="button" name="button" onclick="displayUpdate(< %=plan.level%>)"></button> -->
        <button type="button" name="button" onclick="displayUpdate('<%=plan.level%>','<%=plan.price%>','<%=plan.users.count%>')"></button>
    </p>
  <%end%>


<script type="text/javascript">
function displayUpdate(level,price,userCount){
  console.log("Hello");
  console.log(<%= User.all.count%>)
  console.log(level);
  console.log(price);
  console.log(userCount);
  console.log(<%=Plan.first.revenue_forecast(5)%>)

  planInput="futureValue"+level.toString()
  newPrice = document.getElementById(planInput).value
  console.log("price increase is:" +newPrice)

  newRevenue = userCount * newPrice
  difference = newRevenue - (userCount * price)
  console.log("newRevenue is :" + newRevenue +" and difference is: " +difference)

  forcastDisplay = "forcastDisplay" + level
  document.getElementById(forcastDisplay).textContent="$" + newRevenue + " (+$" + difference +")";
  // document.getElementById("myspan").textContent="newtext";





}



  // var plans = <%= @plans.map{|p| [p.level,p.price]} %>
  // plans.forEach(function(plan){
  //   console.log(plan)
  //   planName="futureValueSubmit"+plan[0].toString()
  //   // console.log(planName)
  //    // document.getElementById(planName).addEventListener("click", displayUpdate(plan[0]));
  //
  // })
  //

  // array1.forEach(function(element) {
  //   console.log(element);
  // });

</script>
